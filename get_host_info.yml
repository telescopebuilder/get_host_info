---
- name: Get Linux Host Information
  hosts: all
  gather_facts: yes
  tasks:
  - name: Get Hostname
    shell: hostname
    register: hostname_result
    
  - name: Get OS
    shell: cat /etc/os-release | grep "PRETTY_NAME" | awk -F '"' '{print $2}'
    register: os_result

  - name: Get OS Release Version
    shell: cat /etc/os-release | grep "VERSION_ID" | awk -F '=' '{print $2}'
    register: os_version_result

  - name: Get Disk Capacity
    shell: df -h | grep "/$" | awk '{print $2}'
    register: disk_capacity_result

  - name: Get Disk Usage
    shell: df -h | grep "/$" | awk '{print $3}'
    register: disk_usage_result

  - name: Check Java Installation
    command: java -version
    register: java_result
    ignore_errors: true

  - name: Get Java Version
    set_fact:
      java_version: "{{ java_result.stdout_lines[0] }}"
    when: java_result.rc == 0

  - name: Check Apache2 Installation
    command: apache2 -v
    register: apache2_result
    ignore_errors: true

  - name: Get Apache2 Version
    set_fact:
      apache2_version: "{{ apache2_result.stdout_lines[0] }}"
    when: apache2_result.rc == 0

  - name: Check MySQL Installation
    command: mysql --version
    register: mysql_result
    ignore_errors: true

  - name: Get MySQL Version
    set_fact:
      mysql_version: "{{ mysql_result.stdout_lines[0] }}"
    when: mysql_result.rc == 0

  - name: Check Apache2 Running
    shell: service apache2 status | grep -o "running"
    register: apache2_running_result
    ignore_errors: true

  - name: Check MySQL Running
    shell: service mysql status | grep -o "running"
    register: mysql_running_result
    ignore_errors: true

  - name: Save Output to File with Hostname as prefix
    copy:
      content: |
        Hostname: {{ hostname_result.stdout }}
        Operating System: {{ os_result.stdout }}
        Operating System Release Version: {{ os_version_result.stdout }}
        Disk Capacity: {{ disk_capacity_result.stdout }}
        Disk Usage: {{ disk_usage_result.stdout }}
        Java: {{ java_result}}
        Java Version: {{ java_version }}
        Apache2: {{ apache2_version }}
        Apache2 Running: {{ apache2_running_result.stdout }}
        MySQL: {{ mysql_result }}
        MySQL Runing: {{ mysql_mysql_running_result.stdout }}
      dest: "/tmp/{{ hostname_result.stdout }}_inventory_information.txt"
    when: hostname_result.stdout and os_result.stdout and os_version_result.stdout and disk_capacity_result.stdout and disk_usage_result.stdout
    
  - name: Print Information
    debug:
      msg: |
        Hostname: {{ hostname_result.stdout }}
        Operating System: {{ os_result.stdout }}
        Operating System Release Version: {{ os_version_result.stdout }}
        Disk Capacity: {{ disk_capacity_result.stdout }}
        Disk Usage: {{ disk_usage_result.stdout }}
        Java: {{ java_result}}
        Java Version: {{ java_version }}
        Apache2: {{ apache2_version }}
        Apache2 Running: {{ apache2_running_result.stdout }}
        MySQL: {{ mysql_result }}
        MySQL Runing: {{ mysql_mysql_running_result.stdout }}
